<h2 mat-dialog-title>Edit Episode</h2>

<mat-dialog-content>
    @if (isLoading) {
    <mat-spinner style="margin:0 auto;" mode="indeterminate"></mat-spinner>
    } @else if (isInError) {
    <p id="error">An error occurred</p>
    } @else {
    <form id="edit" [formGroup]="form!" (ngSubmit)="onSubmit()">
        <mat-tab-group>
            <mat-tab label="Details">
                <label>
                    <span>Podcast:</span>
                    <p>{{podcastName}}</p>
                </label>
                <label>
                    <span>Title:</span>
                    <input type="text" [formControl]="form!.controls.title" matInput>
                </label>
                <label>
                    <span>Description:</span>
                    <textarea [formControl]="form!.controls.description" matInput cdkTextareaAutosize
                        cdkAutosizeMaxRows="5" matInput></textarea>
                </label>
            </mat-tab>
            <mat-tab label="Flags">
                <div class="flags">
                    <label>
                        <span>Posted:</span>
                        <mat-checkbox [formControl]="form!.controls.posted" />
                    </label>
                    <label>
                        <span>Tweeted:</span>
                        <mat-checkbox [formControl]="form!.controls.tweeted" />
                    </label>
                    <label>
                        <span>Bluesky Post:</span>
                        <mat-checkbox [formControl]="form!.controls.blueskyPosted" />
                    </label>
                    <label>
                        <span>Ignored:</span>
                        <mat-checkbox [formControl]="form!.controls.ignored" />
                    </label>
                    <label>
                        <span>Removed:</span>
                        <mat-checkbox [formControl]="form!.controls.removed" />
                    </label>
                    <label>
                        <span>Explicit:</span>
                        <mat-checkbox [formControl]="form!.controls.explicit" />
                    </label>
                </div>
            </mat-tab>
            <mat-tab label="Urls">
                <label>
                    <span>Spotify:</span>
                    <input type="text" [formControl]="form!.controls.spotify" matInput>
                </label>
                <label>
                    <span>Apple:</span>
                    <input type="text" [formControl]="form!.controls.apple" matInput>
                </label>
                <label>
                    <span>YouTube:</span>
                    <input type="text" [formControl]="form!.controls.youtube" matInput>
                </label>
                <mat-accordion>
                    <mat-expansion-panel>
                        <mat-expansion-panel-header>
                            <mat-panel-title>More</mat-panel-title>
                        </mat-expansion-panel-header>
                        <label>
                            <span>BBC:</span>
                            <input type="text" [formControl]="form!.controls.bbc" matInput>
                        </label>
                        <label>
                            <span>Internet Archive:</span>
                            <input type="text" [formControl]="form!.controls.internetArchive" matInput>
                        </label>
                    </mat-expansion-panel>
                </mat-accordion>
            </mat-tab>
            <mat-tab label="Meta">
                <label>
                    <span>Release:</span>
                    <input type="datetime-local" [formControl]="form!.controls.release" matInput>
                </label>
                <label>
                    <span>Duration:</span>
                    <input type="text" [formControl]="form!.controls.duration" matInput>
                </label>
                <label>
                    <span>Subjects:</span>
                    <mat-select [formControl]="form!.controls.subjects" multiple [sortComparator]="noCompareFunction"
                        (selectionChange)="onSubjectsSelectionChange()"
                        (openedChange)="onSubjectsDropdownOpenChange($event)"
                        (keydown)="onSubjectsDropdownKeydown($event)">
                        @if (enableDesktopSubjectTypingFilter && subjectsFilterTerm.length > 0) {
                        <mat-option disabled>{{subjectsFilterTerm}}</mat-option>
                        <mat-divider></mat-divider>
                        }
                        @if (selectedSubjects.length > 0) {
                        @for (subject of selectedSubjects; track subject) {
                        <mat-option [value]="subject">{{subject}}</mat-option>
                        }
                        }
                        @if (hoistedSubjects.length > 0) {
                        @if (selectedSubjects.length > 0) {
                        <mat-divider></mat-divider>
                        }
                        @for (subject of hoistedSubjects; track subject) {
                        <mat-option [value]="subject">{{subject}}</mat-option>
                        }
                        }
                        @if (otherSubjects.length > 0) {
                        @if (selectedSubjects.length > 0 || hoistedSubjects.length > 0) {
                        <mat-divider></mat-divider>
                        }
                        @for (subject of otherSubjects; track subject) {
                        <mat-option [value]="subject">{{subject}}</mat-option>
                        }
                        }
                    </mat-select>
                </label>
                <label>
                    <span>Search Terms:</span>
                    <input type="text" [formControl]="form!.controls.searchTerms" matInput>
                </label>
                <label>
                    <span>Language:</span>
                    <select matNativeControl [formControl]="form!.controls.lang">
                        @for (language of languages | keyvalue:null; track language) {
                        <option [value]="language.key">{{language.value}}</option>
                        }
                    </select>
                </label>
            </mat-tab>
            <mat-tab label="Images">
                <label>
                    <span>Spotify:</span>
                    <input type="text" [formControl]="form!.controls.spotifyImage" matInput>
                </label>
                <label>
                    <span>Apple:</span>
                    <input type="text" [formControl]="form!.controls.appleImage" matInput>
                </label>
                <label>
                    <span>YouTube:</span>
                    <input type="text" [formControl]="form!.controls.youtubeImage" matInput>
                </label>
                <label>
                    <span>Other:</span>
                    <input type="text" [formControl]="form!.controls.otherImage" matInput>
                </label>
            </mat-tab>
            <mat-tab label="Guests">
                <label>
                    <span>Twitter handles:</span>
                    <input type="text" [formControl]="form!.controls.twitterHandles" matInput>
                </label>
                <label>
                    <span>Bluesky handles:</span>
                    <input type="text" [formControl]="form!.controls.blueskyHandles" matInput>
                </label>
            </mat-tab>
        </mat-tab-group>
    </form>
    }
</mat-dialog-content>

<mat-dialog-actions>
    <button mat-raised-button (click)="close()">Close</button>
    <button mat-raised-button [disabled]="!form || !form.valid" (click)="onSubmit()">Submit</button>
</mat-dialog-actions>