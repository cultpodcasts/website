<section id="results" #resultsContainer>

  <div id="progresswrapper">
    <mat-progress-bar mode="indeterminate" *ngIf="isLoading"></mat-progress-bar>
  </div>
  <section id="resultsheading">
    <h2>Discovery results<ng-container *ngIf="this.minDate"> since {{minDate| date:'d MMM yyyy H:mm'}}</ng-container>
    </h2>
  </section>
  <h3 *ngIf="!isLoading && results?.length==0">There are no discovery results</h3>
  <mat-card *ngFor="let result of results" class="result" (click)="handleResult($event, result)"
    attr.data-url="{{result.url}}">
    <mat-card-header>
      <mat-card-title [innerHTML]="result.episodeName"></mat-card-title>
      <mat-card-subtitle>{{result.showName}}</mat-card-subtitle>
      <mat-card-subtitle>{{result.released | date:'d MMM yyyy H:mm'}}
        [{{result.duration.split(".")[0].substring(1)}}]</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content class="resultdescription">
      <ng-container *ngIf="result.imageUrl">
        <img [src]="result.imageUrl">
      </ng-container>
      <p>{{result.episodeDescription}}</p>
    </mat-card-content>
    <mat-card-actions>
      <ng-container *ngIf="isYouTube(result.url)">
        <a href="{{result.url}}" mat-icon-button target="_blank" (click)="allowLink($event)">
          <mat-icon svgIcon="youtube"></mat-icon>
        </a>
        <div *ngIf="result.youTubeViews || result.youTubeChannelMembers" class="youtubemeta">
          <span *ngIf="result.youTubeViews">Views: {{result.youTubeViews}}</span>
          <span *ngIf="result.youTubeChannelMembers">Members: {{result.youTubeChannelMembers}}</span>
        </div>
      </ng-container>
      <a *ngIf="isSpotify(result.url)" href="{{result.url}}" mat-icon-button target="_blank" (click)="allowLink($event)">
        <mat-icon svgIcon="spotify"></mat-icon>
      </a>
      <a *ngIf="isApple(result.url)" href="{{result.url}}" mat-icon-button target="_blank" (click)="allowLink($event)">
        <mat-icon svgIcon="apple-podcasts"></mat-icon>
      </a>
      <mat-card-footer class="subjects">
        <div *ngFor="let subject of result.subjects" class="subject">
          <a [routerLink]="['/subject', subject]">{{subject}}</a>
        </div>
      </mat-card-footer>
    </mat-card-actions>
  </mat-card>

  <div id="actions" *ngIf="results && results.length>0 && displaySave">
    <button mat-raised-button class="mat-primary" (click)="close()" disabled="{{this.closeDisabled}}">Close</button>
    <button mat-raised-button class="mat-primary" (click)="save()" disabled="{{this.saveDisabled}}">Save</button>
  </div>
</section>